= Spring Boot Skeleton
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 2
:sectlinks:
:sectnums:

image:https://img.shields.io/badge/Java-21-ED8B00?logo=openjdk&logoColor=white[Java]
image:https://img.shields.io/badge/Kotlin-2.x-7F52FF?logo=kotlin&logoColor=white[Kotlin]
image:https://img.shields.io/badge/Spring%20Boot-4.x-6DB33F?logo=springboot&logoColor=white[Spring Boot]

== 개요

Spring Boot 4.x와 Kotlin 2.x 기반 멀티 모듈 스켈레톤입니다.
의존성 방향 제어와 레이어 분리 원칙에 따라 모듈을 구성합니다.

새 프로젝트를 시작하려면 이 저장소를 복제하세요.

=== 기술 스택

|===
|기술 |버전 |비고

|Spring Boot
|4.x
|

|Kotlin
|2.x
|

|Gradle
|9.x
|Version Catalog 사용

|JDK
|21
|Virtual Thread 지원
|===

== 프로젝트 구조

[source]
----
modules/
├── common/                     # 공통 유틸리티, 예외, 코드
├── common-web/                 # 웹 공통 (Filter, Interceptor, Handler)
├── domain/                     # 도메인 모델, 비즈니스 규칙
├── application/                # 애플리케이션 서비스
│   └── todo-application/       # Todo 애플리케이션 (Client, Service)
├── infrastructure/             # DB, Cache, HTTP Client, 외부 서비스
└── bootstrap/                  # Spring Boot 앱 모듈
    ├── skeleton-api-app/       # API 서버
    └── skeleton-worker-app/    # Worker 서버
----

=== 모듈 의존성 구조

[source]
----
┌──────────────────────────────────────────────────────────────┐
│                          Bootstrap                           │
│           (skeleton-api-app, skeleton-worker-app)            │
├──────────────────────────────────────────────────────────────┤
│                         common-web                           │
│     (Filters, Interceptors, ExceptionHandler, ApiResource)   │
├──────────────────────────────────────────────────────────────┤
│                         Application                          │
│            (todo-application: Client, Service)               │
├────────────────────────────┬─────────────────────────────────┤
│           Domain           │         Infrastructure          │
│      (Business Rules)      │   (Cache, Redis, RestClient)    │
├────────────────────────────┴─────────────────────────────────┤
│                           Common                             │
│           (Codes, Exceptions, Utils, Extensions)             │
└──────────────────────────────────────────────────────────────┘
----

각 레이어의 역할:

* **Bootstrap**: Spring Boot 실행 모듈. HTTP 요청 진입점
* **common-web**: 웹 공통 인프라 (필터, 인터셉터, 예외 처리)
* **Application**: 비즈니스 로직 오케스트레이션
* **Domain**: 도메인 모델과 비즈니스 규칙
* **Infrastructure**: 외부 시스템 연동 (DB, Cache, HTTP Client)
* **Common**: 모든 모듈에서 사용하는 공통 코드

== 모듈 상세

=== common

모든 모듈이 공유하는 유틸리티와 예외 클래스를 제공합니다.

|===
|패키지 |설명

|`codes`
|ResponseCode, ErrorCode, SuccessCode

|`exceptions`
|KnownException, BizRuntimeException

|`utils/datetime`
|날짜/시간 파싱, 포맷팅, 한글 변환

|`utils/extensions`
|String 마스킹 (이름, 전화번호, 이메일)
|===

link:modules/common/readme.adoc[상세 문서 보기]

=== common-web

필터, 인터셉터, 예외 처리 등 웹 공통 인프라를 제공합니다.

|===
|패키지 |설명

|`filters`
|ContentCachingFilter, AppTraceFilter (UUID v7 traceId)

|`interceptors`
|LogInterceptor, LogResponseBodyInterceptor

|`handlers`
|GlobalExceptionHandlerV2

|`response`
|ApiResource 표준 응답 포맷
|===

link:modules/common-web/readme.adoc[상세 문서 보기]

=== application

비즈니스 로직을 조율하는 서비스 계층입니다.

==== todo-application

외부 API 연동 예제입니다.

|===
|구성 요소 |설명

|`TodoClient`
|`@HttpExchange` 기반 선언적 HTTP Client

|`TodoService`
|비즈니스 로직 래핑

|`TodoClientConfig`
|`@ImportHttpServices` 설정
|===

=== infrastructure

데이터베이스, 캐시, 외부 서비스와 연동합니다.

|===
|기능 |설명

|HTTP Client
|RestClient + Feign 스타일 로깅

|Cache
|Caffeine (L1) + Redis (L2) 2단계 캐시

|Redis Functions
|`redisGet`, `redisSetAsync`, `redisDelete`

|Distributed Lock
|`redisLock` 분산 락

|Async
|Virtual Thread + MDC 컨텍스트 전파
|===

link:modules/infrastructure/readme.adoc[상세 문서 보기]

=== bootstrap

Spring Boot 실행 모듈입니다. 모듈명이 `-app`으로 끝나면 Spring Boot 플러그인이 자동 적용됩니다.

|===
|모듈 |용도

|`skeleton-api-app`
|REST API 서버

|`skeleton-worker-app`
|백그라운드 Worker 서버
|===

== 빠른 시작

=== 빌드

[source,bash]
----
./gradlew build
----

=== 실행

API 서버 실행:
[source,bash]
----
./gradlew :modules:bootstrap:skeleton-api-app:bootRun
----

Worker 서버 실행:
[source,bash]
----
./gradlew :modules:bootstrap:skeleton-worker-app:bootRun
----

=== 테스트

[source,bash]
----
./gradlew test
----

== 설정

=== gradle.properties

프로젝트 그룹과 버전을 정의합니다.

[source,properties]
----
projectGroup=io.glory
projectVersion=0.0.1-SNAPSHOT
----

=== Version Catalog

`gradle/libs.versions.toml`에서 라이브러리 버전을 관리합니다.

* Spring BOM이 관리하는 라이브러리는 버전 생략
* Third-party 라이브러리만 버전 명시

link:gradle/version-releases.adoc[라이브러리 릴리즈 정보 보기]

== 새 모듈 생성

=== Application 모듈 추가

다음 구조로 모듈을 생성하세요.

[source]
----
modules/application/my-application/
├── build.gradle.kts
└── src/main/kotlin/
    └── io/glory/myapplication/
        ├── client/          # HTTP Client 인터페이스
        └── service/         # 애플리케이션 서비스
----

=== Bootstrap 모듈 추가

`-app` 접미사를 가진 모듈은 자동으로 Spring Boot 플러그인이 적용됩니다.

[source]
----
modules/bootstrap/my-api-app/
├── build.gradle.kts
└── src/main/kotlin/
    └── io/glory/myapiapp/
        ├── api/             # Controller
        └── MyApiApplication.kt
----

=== settings.gradle.kts 수정

모듈을 추가한 후 `settings.gradle.kts`에 등록하세요.

[source,kotlin]
----
include(
    "modules:common",
    "modules:common-web",
    "modules:domain",
    "modules:application:my-application",  // 추가
    "modules:infrastructure",
    "modules:bootstrap:my-api-app"         // 추가
)
----
